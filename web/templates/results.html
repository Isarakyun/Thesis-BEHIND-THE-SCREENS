{% extends "base.html" %} {% block title %}Results of {{ youtube_url.video_name }}{% endblock %}

{% block content %}
<div class="py-2 px-4 sm:px-6 bg-slate-200 dark:bg-[#121212] flex items-center fixed top-0 w-full z-50">
  <button type="button" class="text-lg text-black dark:text-white mr-4 sm:mr-6" id="menuToggleButton">
      <i class="ri-menu-line cursor-pointer"></i>
  </button>
  <div class="flex-1 flex items-center space-x-4">
      <a href="{{ url_for('views.home') }}" class="text-base sm:text-m text-black dark:text-white">
          Behind the Screens
      </a>
      {% if user.confirmed_email == False %}
      <span class="text-sm sm:text-m text-red-600">
          Your email hasn't been verified yet. Go to your settings to confirm your email.
      </span>
      {% endif %}
  </div>
</div>

<!-- SUMMARY -->
<div class="mt-5 pt-5 flex justify-center overflow-hidden">
  <table id="summary" class="w-full text-center ml-[50px] mr-[50px] mt-4">
    <thead class="text-white">
      <tr class="bg-red-600 dark:bg-slate-700 text-lg">
        <th class="px-2 py-1">Interpretation of " {{ youtube_url.video_name }} "</th>
      </tr>
    </thead>
    <tbody class="text-gray-900 dark:text-white text-sm">
      <tr>
        <!-- <td class="px-2 py-2">{{ summary }}</td> -->
        <td class="px-2 py-2">
          {% if youtube_url.created_at and count.positive is not none and count.negative is not none and count.neutral is not none and frequent_words %}
          {% set overall_sentiment = 'NEUTRAL' %}
          {% if count.positive >= count.negative and count.positive >= count.neutral %}
            {% set overall_sentiment = 'POSITIVE' %}
          {% elif count.negative >= count.positive and count.negative >= count.neutral %}
            {% set overall_sentiment = 'NEGATIVE' %}
          {% endif %}
            As of {{ youtube_url.created_at|format_date }}, this video has received {{ count.positive }} positive comments, {{ count.negative }} negative comments, and {{ count.neutral }} neutral comments. The most frequently used words are: 
            {% for word in frequent_words %}
              {% if loop.last %}
                and '{{ word.word }}'
              {% else %}
                '{{ word.word }}',
              {% endif %}
            {% endfor %} which were used 
            {% for word in frequent_words %} 
              {% if loop.last %}
                and {{ word.count }} times,
              {% else %}
                {{ word.count }},
              {% endif %}
            {% endfor %} respectively. The overall sentiment is {{ overall_sentiment }}.
          {% else %}
            No interpretation for this video. Either there's not enough information, or there's an error during the analysis. The error might be because of interrupted connection, invalid URL, or the video is not available for analysis (such as ongoing live streams).
          {% endif %}
        </td>
      </tr>
      <tr>
        <td class="px-2 py-2 italic text-yellow-700 dark:text-yellow-600">Please note that the model used for the analysis doesn't recognize slangs or inside jokes depending on the content of the video.</td>
      </tr>
      <tr>
        <td class="px-2 italic text-yellow-700 dark:text-yellow-600">Comments with timestamps and replies aren't included in the analysis.</td>
      </tr>
    </tbody>
  </table>
</div>    

<!-- Most Positive and Negative Comments -->
<div id="high-score-comments" class="flex justify-center overflow-hidden mt-5 pt-5">
  <table class="w-full ml-[50px] mr-[50px]">
    {% if youtube_url.created_at is not none and highscorecomments %}
      <thead class="text-white">
        <tr class="bg-red-600 dark:bg-slate-700 text-lg">
          <th class="px-4 py-1"></th>
          <th class="px-4 py-1">Highlighted Comments</th>
          <th class="px-2 py-1">Score</th>
        </tr>
      </thead>
      <tbody class="text-center text-gray-900 dark:text-white text-sm">
        <tr>
          <td class="px-2 py-2 text-blue-700 dark:text-white dark:bg-blue-700 font-bold">Most Positive</td>
          {% if highscorecomments.most_positive_comment is not none %}
          <td class="px-2 py-2">{{ highscorecomments.most_positive_comment }}</td>
          <td class="px-2 py-2">{{ (highscorecomments.highest_positive_score * 100) | round(2) }}%</td>
          {% else %}
          <td class="px-2 py-2 italic text-gray-500">There are no positive comments found.</td>
          <td class="px-2 py-2"></td>
          {% endif %}
        </tr>
        <tr>
          <td class="px-2 py-2 text-red-700 dark:text-white dark:bg-red-700 font-bold">Most Negative</td>
          {% if highscorecomments.most_negative_comment is not none %}
          <td class="px-2 py-2">{{ highscorecomments.most_negative_comment }}</td>
          <td class="px-2 py-2">{{ (highscorecomments.highest_negative_score * 100) | round(2) }}%</td>
          {% else %}
          <td class="px-2 py-2 italic text-gray-500">There are no negative comments found.</td>
          <td class="px-2 py-2"></td>
          {% endif %}
        </tr>
      </tbody>
    {% else %}
      <thead class="text-white">
        <tr class="bg-red-600 dark:bg-slate-700 text-lg">
          <th class="px-4 py-1">Most Positive and/or Negative Comments</th>
        </tr>
      </thead>
      <tbody class="text-center text-gray-900 dark:text-white text-sm">
        <tr class="sentiment-row">
          <td class="px-2 py-2">There are no comments found.</td>
        </tr>
      </tbody>
    {% endif %}
  </table>
</div>

  <!-- Dropdown for sentiment selection -->
<div class="mt-5 pt-5 flex justify-end ml-[50px] mr-[50px] shadow-lg">
  {% if youtube_url.created_at is not none and frequent_words %}
  <select id="sentiment-filter" class="mb-4 px-4 py-2 border border-red-600 dark:border-slate-700 rounded bg-slate-200 dark:bg-[#121212] text-black dark:text-white">
    <option value="all">All</option>
    <option value="Positive">Positive</option>
    <option value="Negative">Negative</option>
    <option value="Neutral">Neutral</option>
  </select>
  {% endif %}
</div>

<!-- TABLE FOR COMMENTS -->
 <!-- ALL COMMENTS -->
<div id="all-comments" class="flex justify-center overflow-hidden">
  <table id="labeled-comments" class="w-full ml-[50px] mr-[50px]">
    {% if youtube_url.created_at is not none and frequent_words %}
      <thead class="text-white">
        <tr class="bg-red-600 dark:bg-slate-700 text-lg">
          <th class="px-4 py-1 w-4/5">Comments</th>
          <th class="px-2 py-1 w-1/5">Sentiment</th>
        </tr>
      </thead>
      <tbody class="text-center text-gray-900 dark:text-white text-sm">
        {% for comment in comments %}
        <tr class="sentiment-row" data-sentiment="{{ comment.sentiment }}">
          <td class="px-2 py-2">{{ comment.comment }}</td>
          {% if comment.sentiment == "Positive" %}
          <td class="px-2 py-2 text-blue-700">{{ comment.sentiment }}</td>
          {% elif comment.sentiment == "Negative" %}
          <td class="px-2 py-2 text-red-700">{{ comment.sentiment }}</td>
          {% else %}
          <td class="px-2 py-2 text-yellow-700 dark:text-yellow-600">{{ comment.sentiment }}</td>
          {% endif %}
        </tr>
        {% endfor %}
      </tbody>
    {% else %}
      <thead class="text-white">
        <tr class="bg-red-600 dark:bg-slate-700 text-lg">
          <th class="px-4 py-1">Comments</th>
        </tr>
      </thead>
      <tbody class="text-center text-gray-900 dark:text-white text-sm">
        <tr class="sentiment-row">
          <td class="px-2 py-2">There are no comments found.</td>
        </tr>
      </tbody>
    {% endif %}
  </table>
</div>
<div id="all-pagination-controls" class="flex justify-center mt-4"></div>

<!-- POSITIVE COMMENTS -->
<div id="positive-comments" class="flex justify-center overflow-hidden hidden">
  <table id="labeled-positive-comments" class="w-full ml-[50px] mr-[50px]">
    {% if youtube_url.created_at is not none and count.positive is not none and frequent_words %}
      <thead class="text-white">
        <tr class="bg-red-600 dark:bg-slate-700 text-lg">
          <th class="px-4 py-1 w-4/5">Comments</th>
          <th class="px-2 py-1 w-1/5">Sentiment</th>
        </tr>
      </thead>
      <tbody class="text-center text-gray-900 dark:text-white text-sm">
        {% for comment in comments %}
          {% if comment.sentiment == 'Positive' %}
          <tr class="sentiment-row" data-sentiment="{{ comment.sentiment }}">
            <td class="px-2 py-2">{{ comment.comment }}</td>
            <td class="px-2 py-2 text-blue-700">{{ comment.sentiment }}</td>
          </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    {% else %}
      <thead class="text-white">
        <tr class="bg-red-600 dark:bg-slate-700 text-lg">
          <th class="px-4 py-1">Comments</th>
        </tr>
      </thead>
      <tbody class="text-center text-gray-900 dark:text-white text-sm">
        <tr class="sentiment-row">
          <td class="px-2 py-2 text-blue-700">There are no positive comments found.</td>
        </tr>
      </tbody>
    {% endif %}
  </table>
</div>
<div id="positive-pagination-controls" class="flex justify-center mt-4 hidden"></div>

<!-- NEGATIVE COMMENTS -->
<div id="negative-comments" class="flex justify-center overflow-hidden hidden">
  <table id="labeled-negative-comments" class="w-full ml-[50px] mr-[50px]">
    {% if youtube_url.created_at is not none and count.negative is not none and frequent_words %}
      <thead class="text-white">
        <tr class="bg-red-600 dark:bg-slate-700 text-lg">
          <th class="px-4 py-1 w-4/5">Comments</th>
          <th class="px-2 py-1 w-1/5">Sentiment</th>
        </tr>
      </thead>
      <tbody class="text-center text-gray-900 dark:text-white text-sm">
        {% for comment in comments %}
          {% if comment.sentiment == 'Negative' %}
          <tr class="sentiment-row" data-sentiment="{{ comment.sentiment }}">
            <td class="px-2 py-2">{{ comment.comment }}</td>
            <td class="px-2 py-2 text-red-700">{{ comment.sentiment }}</td>
          </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    {% else %}
    <thead class="text-white">
      <tr class="bg-red-600 dark:bg-slate-700 text-lg">
        <th class="px-4 py-1">Comments</th>
      </tr>
    </thead>
    <tbody class="text-center text-gray-900 dark:text-white text-sm">
      <tr class="sentiment-row">
        <td class="px-2 py-2 text-red-700">There are no negative comments found.</td>
      </tr>
    </tbody>
  {% endif %}
  </table>
</div>
<div id="negative-pagination-controls" class="flex justify-center mt-4 hidden"></div>

<!-- NEUTRAL COMMENTS -->
<div id="neutral-comments" class="flex justify-center overflow-hidden hidden">
  <table id="labeled-neutral-comments" class="w-full ml-[50px] mr-[50px]">
    {% if youtube_url.created_at is not none and count.neutral is not none and frequent_words %}
      <thead class="text-white">
        <tr class="bg-red-600 dark:bg-slate-700 text-lg">
          <th class="px-4 py-1 w-4/5">Comments</th>
          <th class="px-2 py-1 w-1/5">Sentiment</th>
        </tr>
      </thead>
      <tbody class="text-center text-gray-900 dark:text-white text-sm">
        {% for comment in comments %}
          {% if comment.sentiment == 'Neutral' %}
          <tr class="sentiment-row" data-sentiment="{{ comment.sentiment }}">
            <td class="px-2 py-2">{{ comment.comment }}</td>
            <td class="px-2 py-2 text-yellow-700 dark:text-yellow-600">{{ comment.sentiment }}</td>
          </tr>
          {% endif %}
        {% endfor %}
      </tbody>
      {% else %}
        <thead class="text-white">
          <tr class="bg-red-600 dark:bg-slate-700 text-lg">
            <th class="px-4 py-1">Comments</th>
          </tr>
        </thead>
        <tbody class="text-center text-gray-900 dark:text-white text-sm">
          <tr class="sentiment-row">
            <td class="px-2 py-2 text-yellow-700 dark:text-yellow-600">There are no neutral comments found.</td>
          </tr>
        </tbody>
      {% endif %}
  </table>
</div>
<div id="neutral-pagination-controls" class="flex justify-center mt-4 hidden"></div>

<!-- SCRIPT FOR ALL COMMENTS -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const rowsPerPage = 5;
    const table = document.getElementById('labeled-comments');
    const tbody = table.querySelector('tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    const paginationControls = document.getElementById('all-pagination-controls');
    let currentPage = 1;

    function renderTable() {
      tbody.innerHTML = '';
      const start = (currentPage - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const paginatedRows = rows.slice(start, end);
      paginatedRows.forEach(row => tbody.appendChild(row));
    }

    function renderPaginationControls() {
      paginationControls.innerHTML = '';
      const totalPages = Math.ceil(rows.length / rowsPerPage);

      // Create '<<' button
      if (currentPage > 1) {
        const prevButton = document.createElement('button');
        prevButton.textContent = '←';
        prevButton.classList.add('rounded', 'px-2', 'py-1', 'mx-1', 'bg-gray-200', 'dark:bg-gray-700', 'text-black', 'dark:text-white');
        prevButton.addEventListener('click', () => {
          if (currentPage > 1) {
            currentPage--;
            renderTable();
            renderPaginationControls();
          }
        });
        paginationControls.appendChild(prevButton);
      }

      // Create page number buttons
      const startPage = Math.max(1, currentPage - 1);
      const endPage = Math.min(totalPages, startPage + 2);

      for (let i = startPage; i <= endPage; i++) {
        const pageButton = document.createElement('button');
        pageButton.textContent = i;
        pageButton.classList.add('rounded', 'px-2', 'py-1', 'mx-1', 'bg-gray-200', 'dark:bg-gray-700', 'text-black', 'dark:text-white');
        if (i === currentPage) {
          pageButton.classList.add('font-bold');
        }
        pageButton.addEventListener('click', () => {
          currentPage = i;
          renderTable();
          renderPaginationControls();
        });
        paginationControls.appendChild(pageButton);
      }

      // Add ellipsis if there are more pages
      if (endPage < totalPages - 1) {
        const ellipsis = document.createElement('span');
        ellipsis.textContent = '...';
        ellipsis.classList.add('mx-1', 'text-black', 'dark:text-white');
        paginationControls.appendChild(ellipsis);
      }

      // Create last page button
      if (endPage < totalPages) {
        const lastPageButton = document.createElement('button');
        lastPageButton.textContent = totalPages;
        lastPageButton.classList.add('rounded', 'px-2', 'py-1', 'mx-1', 'bg-gray-200', 'dark:bg-gray-700', 'text-black', 'dark:text-white');
        if (totalPages === currentPage) {
          lastPageButton.classList.add('font-bold');
        }
        lastPageButton.addEventListener('click', () => {
          currentPage = totalPages;
          renderTable();
          renderPaginationControls();
        });
        paginationControls.appendChild(lastPageButton);
      }

      // Create '>>' button
      if (currentPage < totalPages) {
        const nextButton = document.createElement('button');
        nextButton.textContent = '→';
        nextButton.classList.add('rounded', 'px-2', 'py-1', 'mx-1', 'bg-gray-200', 'dark:bg-gray-700', 'text-black', 'dark:text-white');
        nextButton.addEventListener('click', () => {
          if (currentPage < totalPages) {
            currentPage++;
            renderTable();
            renderPaginationControls();
          }
        });
        paginationControls.appendChild(nextButton);
      }
    }

    renderTable();
    renderPaginationControls();
  });
</script>

<!-- SCRIPT FOR POSITIVE COMMENTS -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const rowsPerPage = 5;
    const table = document.getElementById('labeled-positive-comments');
    const tbody = table.querySelector('tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    const paginationControls = document.getElementById('positive-pagination-controls');
    let currentPage = 1;

    function renderTable() {
      tbody.innerHTML = '';
      const start = (currentPage - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const paginatedRows = rows.slice(start, end);
      paginatedRows.forEach(row => tbody.appendChild(row));
    }

    function renderPaginationControls() {
      paginationControls.innerHTML = '';
      const totalPages = Math.ceil(rows.length / rowsPerPage);

      // Create '<<' button
      if (currentPage > 1) {
        const prevButton = document.createElement('button');
        prevButton.textContent = '←';
        prevButton.classList.add('rounded', 'px-2', 'py-1', 'mx-1', 'bg-gray-200', 'dark:bg-gray-700', 'text-black', 'dark:text-white');
        prevButton.addEventListener('click', () => {
          if (currentPage > 1) {
            currentPage--;
            renderTable();
            renderPaginationControls();
          }
        });
        paginationControls.appendChild(prevButton);
      }

      // Create page number buttons
      const startPage = Math.max(1, currentPage - 1);
      const endPage = Math.min(totalPages, startPage + 2);

      for (let i = startPage; i <= endPage; i++) {
        const pageButton = document.createElement('button');
        pageButton.textContent = i;
        pageButton.classList.add('rounded', 'px-2', 'py-1', 'mx-1', 'bg-gray-200', 'dark:bg-gray-700', 'text-black', 'dark:text-white');
        if (i === currentPage) {
          pageButton.classList.add('font-bold');
        }
        pageButton.addEventListener('click', () => {
          currentPage = i;
          renderTable();
          renderPaginationControls();
        });
        paginationControls.appendChild(pageButton);
      }

      // Add ellipsis if there are more pages
      if (endPage < totalPages - 1) {
        const ellipsis = document.createElement('span');
        ellipsis.textContent = '...';
        ellipsis.classList.add('mx-1', 'text-black', 'dark:text-white');
        paginationControls.appendChild(ellipsis);
      }

      // Create last page button
      if (endPage < totalPages) {
        const lastPageButton = document.createElement('button');
        lastPageButton.textContent = totalPages;
        lastPageButton.classList.add('rounded', 'px-2', 'py-1', 'mx-1', 'bg-gray-200', 'dark:bg-gray-700', 'text-black', 'dark:text-white');
        if (totalPages === currentPage) {
          lastPageButton.classList.add('font-bold');
        }
        lastPageButton.addEventListener('click', () => {
          currentPage = totalPages;
          renderTable();
          renderPaginationControls();
        });
        paginationControls.appendChild(lastPageButton);
      }

      // Create '>>' button
      if (currentPage < totalPages) {
        const nextButton = document.createElement('button');
        nextButton.textContent = '→';
        nextButton.classList.add('rounded', 'px-2', 'py-1', 'mx-1', 'bg-gray-200', 'dark:bg-gray-700', 'text-black', 'dark:text-white');
        nextButton.addEventListener('click', () => {
          if (currentPage < totalPages) {
            currentPage++;
            renderTable();
            renderPaginationControls();
          }
        });
        paginationControls.appendChild(nextButton);
      }
    }

    renderTable();
    renderPaginationControls();
  });
</script>

<!-- SCRIPT FOR NEGATIVE COMMENTS -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const rowsPerPage = 5;
    const table = document.getElementById('labeled-negative-comments');
    const tbody = table.querySelector('tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    const paginationControls = document.getElementById('negative-pagination-controls');
    let currentPage = 1;

    function renderTable() {
      tbody.innerHTML = '';
      const start = (currentPage - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const paginatedRows = rows.slice(start, end);
      paginatedRows.forEach(row => tbody.appendChild(row));
    }

    function renderPaginationControls() {
      paginationControls.innerHTML = '';
      const totalPages = Math.ceil(rows.length / rowsPerPage);

      // Create '<<' button
      if (currentPage > 1) {
        const prevButton = document.createElement('button');
        prevButton.textContent = '←';
        prevButton.classList.add('rounded', 'px-2', 'py-1', 'mx-1', 'bg-gray-200', 'dark:bg-gray-700', 'text-black', 'dark:text-white');
        prevButton.addEventListener('click', () => {
          if (currentPage > 1) {
            currentPage--;
            renderTable();
            renderPaginationControls();
          }
        });
        paginationControls.appendChild(prevButton);
      }

      // Create page number buttons
      const startPage = Math.max(1, currentPage - 1);
      const endPage = Math.min(totalPages, startPage + 2);

      for (let i = startPage; i <= endPage; i++) {
        const pageButton = document.createElement('button');
        pageButton.textContent = i;
        pageButton.classList.add('rounded', 'px-2', 'py-1', 'mx-1', 'bg-gray-200', 'dark:bg-gray-700', 'text-black', 'dark:text-white');
        if (i === currentPage) {
          pageButton.classList.add('font-bold');
        }
        pageButton.addEventListener('click', () => {
          currentPage = i;
          renderTable();
          renderPaginationControls();
        });
        paginationControls.appendChild(pageButton);
      }

      // Add ellipsis if there are more pages
      if (endPage < totalPages - 1) {
        const ellipsis = document.createElement('span');
        ellipsis.textContent = '...';
        ellipsis.classList.add('mx-1', 'text-black', 'dark:text-white');
        paginationControls.appendChild(ellipsis);
      }

      // Create last page button
      if (endPage < totalPages) {
        const lastPageButton = document.createElement('button');
        lastPageButton.textContent = totalPages;
        lastPageButton.classList.add('rounded', 'px-2', 'py-1', 'mx-1', 'bg-gray-200', 'dark:bg-gray-700', 'text-black', 'dark:text-white');
        if (totalPages === currentPage) {
          lastPageButton.classList.add('font-bold');
        }
        lastPageButton.addEventListener('click', () => {
          currentPage = totalPages;
          renderTable();
          renderPaginationControls();
        });
        paginationControls.appendChild(lastPageButton);
      }

      // Create '>>' button
      if (currentPage < totalPages) {
        const nextButton = document.createElement('button');
        nextButton.textContent = '→';
        nextButton.classList.add('rounded', 'px-2', 'py-1', 'mx-1', 'bg-gray-200', 'dark:bg-gray-700', 'text-black', 'dark:text-white');
        nextButton.addEventListener('click', () => {
          if (currentPage < totalPages) {
            currentPage++;
            renderTable();
            renderPaginationControls();
          }
        });
        paginationControls.appendChild(nextButton);
      }
    }

    renderTable();
    renderPaginationControls();
  });
</script>

<!-- SCRIPT FOR NEUTRAL COMMENTS -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const rowsPerPage = 5;
    const table = document.getElementById('labeled-neutral-comments');
    const tbody = table.querySelector('tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    const paginationControls = document.getElementById('neutral-pagination-controls');
    let currentPage = 1;

    function renderTable() {
      tbody.innerHTML = '';
      const start = (currentPage - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const paginatedRows = rows.slice(start, end);
      paginatedRows.forEach(row => tbody.appendChild(row));
    }

    function renderPaginationControls() {
      paginationControls.innerHTML = '';
      const totalPages = Math.ceil(rows.length / rowsPerPage);

      // Create '<<' button
      if (currentPage > 1) {
        const prevButton = document.createElement('button');
        prevButton.textContent = '←';
        prevButton.classList.add('rounded', 'px-2', 'py-1', 'mx-1', 'bg-gray-200', 'dark:bg-gray-700', 'text-black', 'dark:text-white');
        prevButton.addEventListener('click', () => {
          if (currentPage > 1) {
            currentPage--;
            renderTable();
            renderPaginationControls();
          }
        });
        paginationControls.appendChild(prevButton);
      }

      // Create page number buttons
      const startPage = Math.max(1, currentPage - 1);
      const endPage = Math.min(totalPages, startPage + 2);

      for (let i = startPage; i <= endPage; i++) {
        const pageButton = document.createElement('button');
        pageButton.textContent = i;
        pageButton.classList.add('rounded', 'px-2', 'py-1', 'mx-1', 'bg-gray-200', 'dark:bg-gray-700', 'text-black', 'dark:text-white');
        if (i === currentPage) {
          pageButton.classList.add('font-bold');
        }
        pageButton.addEventListener('click', () => {
          currentPage = i;
          renderTable();
          renderPaginationControls();
        });
        paginationControls.appendChild(pageButton);
      }

      // Add ellipsis if there are more pages
      if (endPage < totalPages - 1) {
        const ellipsis = document.createElement('span');
        ellipsis.textContent = '...';
        ellipsis.classList.add('mx-1', 'text-black', 'dark:text-white');
        paginationControls.appendChild(ellipsis);
      }

      // Create last page button
      if (endPage < totalPages) {
        const lastPageButton = document.createElement('button');
        lastPageButton.textContent = totalPages;
        lastPageButton.classList.add('rounded', 'px-2', 'py-1', 'mx-1', 'bg-gray-200', 'dark:bg-gray-700', 'text-black', 'dark:text-white');
        if (totalPages === currentPage) {
          lastPageButton.classList.add('font-bold');
        }
        lastPageButton.addEventListener('click', () => {
          currentPage = totalPages;
          renderTable();
          renderPaginationControls();
        });
        paginationControls.appendChild(lastPageButton);
      }

      // Create '>>' button
      if (currentPage < totalPages) {
        const nextButton = document.createElement('button');
        nextButton.textContent = '→';
        nextButton.classList.add('rounded', 'px-2', 'py-1', 'mx-1', 'bg-gray-200', 'dark:bg-gray-700', 'text-black', 'dark:text-white');
        nextButton.addEventListener('click', () => {
          if (currentPage < totalPages) {
            currentPage++;
            renderTable();
            renderPaginationControls();
          }
        });
        paginationControls.appendChild(nextButton);
      }
    }

    renderTable();
    renderPaginationControls();
  });
</script>

<!-- SCRIPT FOR FILTERING COMMENTS (hiding and unhiding the table) -->
<script>
  document.getElementById('sentiment-filter'). addEventListener('change', function() {
    var selectedSentiment = this.value;
    var allComments = document.getElementById('all-comments');
    var positiveComments = document.getElementById('positive-comments');
    var negativeComments = document.getElementById('negative-comments');
    var neutralComments = document.getElementById('neutral-comments');

    var allPaginationControls = document.getElementById('all-pagination-controls');
    var positivePaginationControls = document.getElementById('positive-pagination-controls');
    var negativePaginationControls = document.getElementById('negative-pagination-controls');
    var neutralPaginationControls = document.getElementById('neutral-pagination-controls');

    if (selectedSentiment === 'all') {
      allComments.classList.remove('hidden');
      positiveComments.classList.add('hidden');
      negativeComments.classList.add('hidden');
      neutralComments.classList.add('hidden');

      allPaginationControls.classList.remove('hidden');
      positivePaginationControls.classList.add('hidden');
      negativePaginationControls.classList.add('hidden');
      neutralPaginationControls.classList.add('hidden');
    } 
    else if (selectedSentiment === 'Positive') {
      allComments.classList.add('hidden');
      positiveComments.classList.remove('hidden');
      negativeComments.classList.add('hidden');
      neutralComments.classList.add('hidden');

      allPaginationControls.classList.add('hidden');
      positivePaginationControls.classList.remove('hidden');
      negativePaginationControls.classList.add('hidden');
      neutralPaginationControls.classList.add('hidden');
    } 
    else if (selectedSentiment === 'Negative') {
      allComments.classList.add('hidden');
      positiveComments.classList.add('hidden');
      negativeComments.classList.remove('hidden');
      neutralComments.classList.add('hidden');
      
      allPaginationControls.classList.add('hidden');
      positivePaginationControls.classList.add('hidden');
      negativePaginationControls.classList.remove('hidden');
      neutralPaginationControls.classList.add('hidden');
    } 
    else if (selectedSentiment === 'Neutral') {
      allComments.classList.add('hidden');
      positiveComments.classList.add('hidden');
      negativeComments.classList.add('hidden');
      neutralComments.classList.remove('hidden');
      
      allPaginationControls.classList.add('hidden');
      positivePaginationControls.classList.add('hidden');
      negativePaginationControls.classList.add('hidden');
      neutralPaginationControls.classList.remove('hidden');
    }
  })
</script>

{% if frequent_words %}
<!-- Table for Word Count and Bar Chart -->
<div id="frequent-words" class="flex justify-center overflow-hidden mt-5 pt-5">
  <table class="w-1/2 ml-[50px] mr-[50px]">
      <thead class="text-white">
        <tr class="bg-red-600 dark:bg-slate-700 text-lg">
          <th class="px-4 py-1">Word</th>
          <th class="px-4 py-1">Count</th>
          <th class="px-2 py-1">Sentiment</th>
        </tr>
      </thead>
      <tbody class="text-center text-gray-900 dark:text-white text-sm">
        {% for word in frequent_words %}
        <tr>
          <td class="px-2 py-2">{{ word.word }}</td>
          <td class="px-2 py-2">{{ word.count }} times</td>
          {% if word.sentiment == "Positive" %}
          <td class="px-2 py-2 text-blue-700">{{ word.sentiment }}</td>
          {% elif word.sentiment == "Negative" %}
          <td class="px-2 py-2 text-red-700">{{ word.sentiment }}</td>
          {% else %}
          <td class="px-2 py-2 text-yellow-700 dark:text-yellow-600">{{ word.sentiment }}</td>
          {% endif %}
        </tr>
        {% endfor %}
      </tbody>
  </table>
  <!-- Bar Chart -->
  <div class="ml-4 mr-[50px] w-1/2">
    <canvas id="barChart" width="250px" height="250px"></canvas>
  </div>
</div>
{% endif %}

  <!-- did i mention i love fictional characters -->
  <!-- even if you did not, it's obvious xd -->
  <!-- bruh i didnt expect someone would reply here, i was just gonna give ppl who do "inspect element" something here -->
  <!-- one of the devs/researchers here aint straight. it's me (hint is in one of the pages). --> 

<!-- script for bar chart -->
<script>
  async function fetchSentimentData(urlId) {
    const response = await fetch(`/api/sentiment/${urlId}`);
    const data = await response.json();
    return data;
  }

  async function updateBarChart(urlId) {
    const data = await fetchSentimentData(urlId);
    const ctx = document.getElementById('barChart').getContext('2d');
    const barChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Negative', 'Positive', 'Neutral'],
        datasets: [{
          label: 'Number of Comments Based on Sentiment',
          data: [data.negative, data.positive, data.neutral],
          backgroundColor: ['#b91c1c', '#1d4ed8', '#fbbf24'],
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true
          }
        },
        plugins: {
          legend: {
            position: 'top',
          },
          tooltip: {
            callbacks: {
              label: function(tooltipItem) {
                return tooltipItem.label + ': ' + tooltipItem.raw;
              }
            }
          }
        }
      }
    });
  }

  function getUrlParameter(name) {
    name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
    const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
    const results = regex.exec(location.search);
    return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
  }

  function getUrlPathParameter(position) {
    const pathSegments = window.location.pathname.split('/');
    return pathSegments[position] || null;
  }

  window.onload = function() {
    const urlId = getUrlPathParameter(2);
    if (urlId) {
      updateBarChart(urlId);
    } else {
      console.error('url_id parameter is missing in the URL');
    }
  };
</script>

  <!-- WordCloud -->
  <div class="rounded ml-[50px] mr-[50px] mt-5 bg-red-600 dark:bg-slate-700 p-1">
    <a class="text-white font-bold ml-2">Word Cloud</a>
  </div>     
  <div class="pb-8">
    <div class="flex justify-center">
      <!-- POSITIVE WORD CLOUD -->
      <div class="mt-[20px] ml-[50px] mr-4">
        {% if image_positive_data %} 
          <img class="italic text-gray-500 w-full rounded" src="{{ url_for('static', filename='wordcloud/' ~ image_positive_data) }}" alt="Positive Word Cloud">
          <!-- <img class="italic text-gray-500 w-full rounded" src="data:image/png;base64,{{ image_positive_data }}" alt="Positive Word Cloud"> -->
        {% else %}
          <p class="italic text-gray-500 text-center mt-2">Not enough information.</p>
        {% endif %}
        <p class="text-black dark:text-white text-center mt-2">Positive</p>
      </div>
      <!-- NEGATIVE WORD CLOUD -->
      <div class="mt-[20px] ml-4 mr-[50px]">
        {% if image_negative_data %}
          <img class="italic text-gray-500 w-full rounded" src="{{ url_for('static', filename='wordcloud/' ~ image_negative_data) }}" alt="Negative Word Cloud">
          <!-- <img class="italic text-gray-500 w-full rounded" src="data:image/png;base64,{{ image_negative_data }}" alt="Negative Word Cloud"> -->
        {% else %}
          <p class="italic text-gray-500 text-center mt-2">Not enough information.</p>
        {% endif %}
        <p class="text-black dark:text-white text-center mt-2">Negative</p>
      </div>
    </div>
  </div>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
    <div class="fixed bottom-4 right-4 space-y-4">
        {% for category, message in messages %}
        {% if category == 'error' %}
        <div class="alert bg-red-500 text-black p-3 text-sm rounded shadow-lg">
            {{ message }}
            <button type="button" class="ml-4 float-right" data-dismiss="alert" onclick="this.parentElement.style.display='none'">&times;</button>
        </div>
        {% else %}
        <div class="alert bg-blue-600 text-white p-3 text-sm rounded shadow-lg">
            {{ message }}
            <button type="button" class="ml-4 float-right" data-dismiss="alert" onclick="this.parentElement.style.display='none'">&times;</button>
        </div>
        {% endif %}
        {% endfor %}
    </div>
{% endif %}
{% endwith %}
{% endblock %}
